# FM音源ボードシミュレートVST『2686V』・ADPCM/リズム音源出力シミュレートビットクラッシャーVST『2686VFX』

## 目的

- DAW上で、80~90年代のパソコンやゲーム機で使用されていたFM音源ボードを再現させる

## 規格

- VST3(VST SDK最新バージョン)

## OS

- Windows(x64)

## 開発環境

- Microsoft Visual Studio 2026 Community
- Microsoft Visual Studio Code
  - CMakeを使用した環境構築を必要とした場合に使用

## 基本仕様

- MIDIの入力によって、FM音源ボードの音声を鳴らせる
  - ベロシティはMIDIのVelocity値に依る
- 後述する構成のうち、どれか一つを選んでパラメータを設定する
- ポリフォニック対応で、ボイス数は最大32ボイス
  - 最大32和音を出力できるようにする
- マルチディンバー非対応
- 音源は、FM以外に「SSG」「PSG」「ノイズ音源」「リズム音源」「ADPCM」がある
  - FM・SSG・PSG・ノイズ音源では、MIDIの入力に対して、各パラメータで設定された値と、MIDI入力のキー・ベロシティなどの値を組み合わせて音が鳴る
    - ポリフォニック対応
  - リズム音源は、パートごとにMIDIキーを割り当て、対応するキーが入力されたときに再生する
    - 各パートの音は、音声ファイルをロードさせて、それを鳴らせる(ドラムマシンのような機能)
    - ポリフォニック対応で、すべてのパートの音を同時に鳴らせられる
  - ADPCMは、再生する音声ファイルを指定し、MIDI入力(キー・ベロシティ)によって再生を制御する(サンプラーのような機能)
    - ポリフォニック対応
  - 再生される音質は、それぞれの音源仕様に依存する(ビット深度・サンプリングレート)
- 各音源向けに作成した設定は、ユーザープリセットとしてファイルに保存できる
  - ADPCMは使用している音源ファイルのパスを保存する
- CSM音声合成モード非対応
- 効果音モード対応

## 使用ライブラリ

- それぞれをサブリポジトリとして利用する

### VST3SDK(最新版)

- <git@github.com>:steinbergmedia/vst3sdk.git

### JUCE(最新版)

- <git@github.com>:juce-framework/JUCE.git

## 音源構成

### FM音源

- YM3526(OPL)
- YM2413(OPLL)
- YM3812(OPL2)
- YMF262(OPL3)
- YM2151(OPM)
- YM2203(OPN)
- YM2612(OPN2)
- YM2608B(OPNA)

### SSG/PSG/ノイズ音源

- YM2608B(SSG)

### リズム音源

- YM2608B

### ADPCM

- YM2608B

## パラメータ設定

### FM音源のパラメータ設定

- オペレータのADSRやアルゴリズム等、各種パラメーターを調節できるようにする
  - 効果音モードが可能な音源の場合、効果音モードを考慮したパラメータ構成にすること
- 対象音源の仕様に沿ったビット深度・サンプリングレートで鳴らせる
  - 細かい設定はユーザーが調整可能
  - 最大の出力深度ビットとサンプリングレートは32bit/96kHz

### SSG/PSG音源のパラメータ設定

- エンベロープなどの各種パラメーターを調節できるようにする
- 対象音源の仕様に沿ったビット深度・サンプリングレートで鳴らせる
  - 細かい設定はユーザーが調整可能
  - 最大の出力深度ビットとサンプリングレートは32bit/96kHz

### ノイズ音源のパラメータ設定

- 各種パラメーターを調節できるようにする
- 対象音源の仕様に沿ったビット深度・サンプリングレートで鳴らせる
  - 細かい設定はユーザーが調整可能
  - 最大の出力深度ビットとサンプリングレートは32bit/96kHz

### リズム音源のパラメータ設定

- 各パートにキーをアサインする
  - ドラムマシンのような構造

- 各パートは標準の音声ファイルを用意するが、ユーザーが好きな音を指定できる
  - 指定できる音声ファイルは wav, aiff, mp3, ogg, flac
  - 表順に戻すボタンも用意する

- YM2608Bの仕様に沿ったビット深度・サンプリングレートで鳴らす
  - 細かい設定はユーザーが調整可能
  - 最大の出力深度ビットとサンプリングレートは32bit/96kHz

### ADPCMのパラメータ設定

- MIDIの中央のCをベースにして音の高低を変える
  - サンプラーのような構造
- 標準は未指定で、ユーザーが好きな音を指定する
  - 指定できる音声ファイルは wav, aiff, mp3, ogg, flac
  - 表順に戻すボタンも用意する
- YM2608Bの仕様に沿ったビット深度・サンプリングレートで鳴らす
  - 細かい設定はユーザーが調整可能
  - 最大の出力深度ビットとサンプリングレートは32bit/96kHz

## UI

### 音源パネル

- 「音源構成」で示した項目ごとにタブが存在する

#### 音源パネルのタブ構成

- OPL(YM3526)
- OPLL(YM2413)
- OPL2(YM3812)
- OPL3(YMF262)
- OPM(YM2151)
- OPN(YM2203)
- OPN2(YM2612)
- OPNA(YM2608B)
- OPNB(YM2610)
- SSG音源(YM2608B)
- PSG音源(YMF288)
- リズム音源(YM2608B)
- ノイズ音源(YM2608B)
- ADPCM(YM2608B)

#### 各タブの仕様

- それぞれのタブには、音源に応じたパラメータが表示され、ボタンやスライドバーで調節する
  - FM音源のタブでは、ADSRとアルゴリズムを図示させる
    - 各パラメーターの値と同期させる
    - 各パラメータは、キーボードで値を直接入力できる仕様にする
  - SSG/PCM/ノイズ音源のタブでは、最終的な波形を図示させる
    - 各パラメーターの値と同期させる
    - 各パラメータは、キーボードで値を直接入力できる仕様にする
  - リズム音源タブでは、MIDIキーアサインを表示させる(GUIはキーパッド風)
    - 各パートのファイルパスと、選択ダイアログ表示ボタンも表示される
    - アサインするキーは変更可能
  - ADPCMタブでは、ファイルパスが表示される

### FXパネル

- 音源から出力された音にたいしてエフェクトを掛ける
  - バイパス可能
  - 標準はバイパス

- 組み込まれるエフェクトは以下
  - フィルタ
  - EQ
  - ディレイ
  - ビブラート
  - リバーブ

### プリセットパネル

- 使用しているプリセットの概要を表示させたり、セーブ・ロードを行う
  - ユーザープリセットの保存もこのパネルで行う
    - ファイルダイアログによるファイル選択
    - プリセットのサブフォルダも作成可能
  - プリセット名・音源名・作成者・ファイルパスを表示
  - プリセット名もこのパネルで変更可能
  - プリセットをロードした際、音源のタブをプリセットに応じたものに自動的に切り替える
    - パラメータの値や図示も、ロードした内容に同期する

### プリセットブラウザ

- プリセットの一覧を管理する
  - 標準プリセットフォルダとユーザープリセットフォルダを走査して、一覧を取得する
  - サブフォルダも走査する

### 設定パネル

- 以下の設定が可能
  - 作成者
  - 標準プリセットを保存するディレクトリ
  - ユーザープリセットを保存するディレクトリ
  - 背景ファイルパス
- これらの設定をファイルとして保存・呼び出しできるようにしておく

## プリセット

- プリセットは、各PC等でよく使われる音色を用意する(BASICで設定されている音色パラメータを参考にする)
  - PC-9801
  - PC-8801
  - X68000
  - MSX
  - メガドライブ

## 2686VFX

- リズム音源・ADPCMで使用するビット深度・サンプリングレートで出力できるビットクラッシャープラグインを、独立したVST3エフェクトとして作成する
  - 深度ビットとサンプリングレートは各音源YM2608B相当とするが、他の深度ビットとサンプリングレート(最大32bit/96kHz)なども可能にする
